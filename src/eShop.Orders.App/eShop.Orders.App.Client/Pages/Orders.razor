@page "/orders"
@rendermode InteractiveWebAssembly
@using System.Net.Http.Json
@using System.Net.Http
@using Microsoft.AspNetCore.Components.WebAssembly.Http
@inject HttpClient Http

<PageTitle>Orders</PageTitle>

<h1>Orders</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="PlaceAnOrder">Place an Order</button>

<p></p>

<textarea rows="10" class="form-control" placeholder="Enter order details in JSON format" @bind="orderJson"></textarea>

@if (!string.IsNullOrEmpty(statusMessage))
{
    <div class="alert alert-info mt-3">@statusMessage</div>
}

@code {
    private int currentCount = 0;
    private string orderJson = string.Empty;
    private string statusMessage = string.Empty;

    private async Task<string> PlaceAnOrder()
    {
        if (string.IsNullOrWhiteSpace(orderJson))
        {
            statusMessage = "Please enter order details";
            return string.Empty;
        }

        try
        {
            var order = new OrdersProxy(Http);
            var response = await order.CreateOrder(orderJson);

            if (response.IsSuccessStatusCode)
            {
                currentCount++;
                statusMessage = "Order placed successfully!";
                orderJson = string.Empty;
            }
            else
            {
                var content = await response.Content.ReadAsStringAsync();
                statusMessage = $"Failed to place order: {(int)response.StatusCode} - {content}";
            }
        }
        catch (HttpRequestException ex)
        {
            statusMessage = $"HTTP Error: {ex.Message}";
        }
        catch (Exception ex)
        {
            statusMessage = $"Error: {ex.Message}";
        }

        return statusMessage;
    }
}